<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <title>프로필</title>
  </head>
  <body>
    <fieldset>
      <legend>수정/삭제</legend>
      <section class="card">
        <form class="card__form" id="form_profile">
          <input type="hidden" name="id" value="<%=data.id%>" disabled />
          <label for="userid" class="visually">ID :</label>
          <div><input id="userid" class="card__input" type="text" name="userid" value="<%=data.userid%>" readonly /></div>
          <label for="password" class="visually">Password :</label>
          <input id="password" class="card__input" type="password" name="pw" value="<%=data.password%>" required />
          <label for="name" class="visually">Name :</label>
          <input id="name" class="card__input" type="text" name="name" value="<%=data.name%>" required />
          <button class="card__button" type="button" onclick="profileEdit();">
            <span>Edit</span>
          </button>
          <button class="card__button" type="button" onclick="profileDelete();">
            <span>Delete</span>
          </button>
        </form>
      </section>
    </fieldset>
  </body>
  <script>
    function profileEdit() {
      var form = document.getElementById("form_profile");
      if (!form.checkValidity()) {
        form.reportValidity();

        return false;
      }
      let data = {
        userid: form.userid.value,
        password: form.password.value,
        name: form.name.value
      };
      axios({
        method: 'patch',
        url: `/profile/edit/${form.id.value}`,
        data: data
      }).then((res) => {
        if (res.data.result) {
          alert("회원정보 수정 성공");
        } else {
          alert("알 수 없는 문제가 발생했습니다.");
        }
      }).catch((err) => {
        alert("알 수 없는 문제가 발생했습니다.");
      });
    }

    function profileDelete() {
      var form = document.getElementById("form_profile");
      if (!form.checkValidity()) {
        form.reportValidity();

        return false;
      }

      axios({
        method: 'delete',
        url: `/profile/delete/${form.id.value}`,
      }).then((res) => {
        if (res.data.result) {
          alert("회원 탈퇴 성공");
          document.location.href = "/signin";
        } else {
          alert("알 수 없는 문제가 발생했습니다.");
        }
      });
    }
  </script>
</html>